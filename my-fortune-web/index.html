<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人生K线图 - 财富趋势分析</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { background-color: #0d1117; color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; text-align: center; }
        h1 { color: #f0b90b; margin-bottom: 10px; }
        .input-group { margin: 20px 0; background: #1c2128; padding: 20px; border-radius: 12px; border: 1px solid #30363d; }
        input { padding: 10px; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; margin-right: 10px; }
        button { padding: 10px 20px; background: #f0b90b; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #chart { width: 100%; height: 500px; margin-top: 20px; background: #1c2128; border-radius: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>人生K线图 <sup>Beta</sup></h1>
        <p style="color: #8b949e;">基于星历算法的可视化运势分析站</p>
        
        <div class="input-group">
            <input type="number" id="birthYear" placeholder="出生年份 (例: 1995)" min="1900" max="2025">
            <button onclick="generateChart()">生成我的K线</button>
        </div>

        <div id="chart"></div>
        <p style="font-size: 12px; color: #484f58; margin-top: 20px;">* 免责声明：本工具基于娱乐算法，不构成投资建议。</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
<script>
function generateChart() {
    const yearInput = document.getElementById('birthYear').value;
    if (!yearInput || yearInput < 1900 || yearInput > 2025) return alert('請輸入有效的出生年份');

    const chartDom = document.getElementById('chart');
    const myChart = echarts.init(chartDom, 'dark');
    
    // 1. 初始化命理數據
    const birthYear = parseInt(yearInput);
    const data = [];
    const years = [];
    
    // 獲取用戶生肖（簡單邏輯基準）
    const zodiacs = ["鼠", "牛", "虎", "兔", "龍", "蛇", "馬", "羊", "猴", "雞", "狗", "豬"];
    const userZodiac = zodiacs[(birthYear - 4) % 12];
    
    let baseScore = 60; // 初始能量值

    // 2. 模擬未來 50 年的流年走勢
    for (let i = 0; i < 50; i++) {
        let currentYear = birthYear + i;
        years.push(currentYear + '年');
        
        // 獲取流年干支能量
        const lunar = Lunar.fromDate(new Date(currentYear, 0, 1));
        const ganZhi = lunar.getYearInGanZhi(); // 例如 "甲辰"
        
        // --- 核心偽算法：根據干支與生肖的關係定漲跌 ---
        let trend = 0;
        
        // 簡單邏輯：如果是本命年，震盪（洗盤）
        if (currentYear % 12 === birthYear % 12) {
            trend = (Math.random() - 0.5) * 10; 
        } 
        // 簡單邏輯：合則漲，沖則跌 (這裡使用隨機種子模擬固定的運勢軌跡)
        else {
            const seed = (currentYear * birthYear) % 100;
            trend = (seed > 50 ? 1 : -1) * (seed % 15);
        }

        let open = baseScore;
        let close = baseScore + trend + (Math.random() * 4 - 2);
        let low = Math.min(open, close) - Math.random() * 5;
        let high = Math.max(open, close) + Math.random() * 8;

        data.push([
            parseFloat(open.toFixed(2)), 
            parseFloat(close.toFixed(2)), 
            parseFloat(low.toFixed(2)), 
            parseFloat(high.toFixed(2))
        ]);
        
        baseScore = close; // 下一年承接前一年的收盤
    }

    const option = {
        backgroundColor: 'transparent',
        title: { text: userZodiac + '年出生者 - 人生資產K線圖', left: 'center', textStyle: {color: '#f0b90b'} },
        tooltip: { 
            trigger: 'axis', 
            axisPointer: { type: 'cross' },
            formatter: function(params) {
                let p = params[0];
                return p.name + '<br/>' +
                       '起始能量: ' + p.data[1] + '<br/>' +
                       '結尾能量: ' + p.data[2] + '<br/>' +
                       '最低谷值: ' + p.data[3] + '<br/>' +
                       '巔峰能量: ' + p.data[4];
            }
        },
        grid: { left: '10%', right: '10%', bottom: '15%' },
        xAxis: { type: 'category', data: years, axisLine: { lineStyle: { color: '#484f58' } } },
        yAxis: { scale: true, splitLine: { lineStyle: { color: '#30363d' } }, axisLabel: { show: false } },
        dataZoom: [{ type: 'inside', start: 0, end: 100 }, { show: true, type: 'slider', top: '90%' }],
        series: [{
            name: '運势K線',
            type: 'candlestick',
            data: data,
            itemStyle: {
                color: '#ef232a', color0: '#14b143',
                borderColor: '#ef232a', borderColor0: '#14b143'
            }
        }]
    };

    myChart.setOption(option);
}
</script>
</body>
</html>