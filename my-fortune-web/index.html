<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life K-Line Pro | å°ˆæ¥­å¤©å‘½çµ‚ç«¯</title>
    <style>
        :root { 
            --gold: #f0b90b; --bg: #0b0e11; --card: #161a1e; --border: #2b2f36;
            --text-main: #eaecef; --text-dim: #848e9c; --green: #0ecb81; --red: #f6465d; 
        }
        body { background: var(--bg); color: var(--text-main); font-family: "PingFang SC", sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; box-sizing: border-box; }
        
        /* å»£å‘Šä½æ¨£å¼ */
        .ad-banner { width: 100%; min-height: 60px; background: #1c2127; border: 1px dashed var(--border); margin: 10px 0; display: flex; align-items: center; justify-content: center; color: var(--text-dim); font-size: 11px; border-radius: 4px; overflow: hidden; }

        .header { display: flex; justify-content: space-between; align-items: center; margin: 5px 0 15px; width: 100%; }
        .header h2 { font-size: 16px; color: var(--gold); margin: 0; letter-spacing: 1px; }
        .lang-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 12px; border-radius: 4px; font-size: 11px; cursor: pointer; }

        .destiny-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .stat-box { background: var(--card); border: 1px solid var(--border); padding: 10px 5px; border-radius: 4px; text-align: center; border-top: 2px solid var(--gold); }
        .stat-label { font-size: 10px; color: var(--text-dim); margin-bottom: 4px; }
        .stat-value { font-size: 13px; color: var(--gold); font-weight: bold; }

        /* è¼¸å…¥æ¡†å°é½Š */
        .input-grid { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; }
        .input-group { flex: 1; display: flex; flex-direction: column; }
        .input-group label { font-size: 10px; color: var(--text-dim); margin-bottom: 4px; padding-left: 2px; }
        input { background: #1e2329; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 6px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; text-align: center; }
        input:focus { border-color: var(--gold); }

        #main-btn { width: 100%; background: var(--gold); color: #000; border: none; padding: 16px; border-radius: 6px; font-weight: 800; font-size: 16px; cursor: pointer; }

        /* åœ–è¡¨èˆ‡äº¤äº’ */
        #canvasWrap { width: 100%; height: 320px; background: #0b0e11; border: 1px solid var(--border); position: relative; border-radius: 6px; margin-top: 15px; cursor: crosshair; }
        canvas { display: block; width: 100%; height: 100%; }
        #tooltip { position: absolute; display: none; background: rgba(30, 35, 41, 0.95); border: 1px solid var(--gold); padding: 10px; border-radius: 4px; font-size: 12px; z-index: 1000; pointer-events: none; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.5); min-width: 80px; }

        #shareArea { display: none; margin-top: 20px; border: 1px solid var(--border); padding: 20px; border-radius: 6px; background: #161a1e; border-left: 5px solid var(--gold); }
        #shareText { font-size: 14px; line-height: 1.8; color: var(--text-main); white-space: pre-wrap; }
        .highlight { color: var(--gold); font-weight: bold; }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; display: none; width: 100%; }
        .share-btn { background: #2b2f36; color: white; border: none; padding: 14px; font-size: 12px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-gold { background: var(--gold); color: #000; }

        footer { margin-top: 40px; font-size: 11px; color: var(--text-dim); text-align: center; border-top: 1px solid var(--border); padding: 25px 0; line-height: 1.8; }
        .privacy-links a { color: var(--text-dim); text-decoration: none; margin: 0 8px; border-bottom: 1px solid #474d57; }
    </style>
</head>
<body>

    <div class="container">
        <div class="ad-banner">ADVERTISEMENT - TOP BANNER</div>

        <div class="header">
            <h2 id="t-title">LIFE K-LINE TERMINAL</h2>
            <button class="lang-btn" id="lang-btn">English / ä¸­æ–‡</button>
        </div>

        <div class="destiny-dashboard">
            <div class="stat-box"><div class="stat-label" id="t-l1">å¹´æŸ±/æ ¼å±€</div><div class="stat-value" id="val-gz">--</div></div>
            <div class="stat-box"><div class="stat-label" id="t-l2">ç´«å¾®ä¸»æ˜Ÿ</div><div class="stat-value" id="val-star">--</div></div>
            <div class="stat-box"><div class="stat-label" id="t-l3">ç´éŸ³/å±¬æ€§</div><div class="stat-value" id="val-na">--</div></div>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label id="t-y">YEAR</label>
                <input type="number" id="year" placeholder="YYYY">
            </div>
            <div class="input-group">
                <label id="t-m">MONTH</label>
                <input type="number" id="month" placeholder="MM">
            </div>
            <div class="input-group">
                <label id="t-d">DAY</label>
                <input type="number" id="day" placeholder="DD">
            </div>
        </div>

        <button id="main-btn">START ANALYSIS</button>
        
        <div id="canvasWrap">
            <div id="tooltip"></div>
            <canvas id="kCanvas"></canvas>
        </div>

        <div id="shareArea">
            <div id="shareText"></div>
            <div class="ad-banner" style="margin-top:20px; border-style: solid;">SPONSORED CONTENT</div>
        </div>

        <div class="action-grid" id="action-grid">
            <button class="share-btn btn-gold" id="save-btn">ğŸ“¸ SAVE CHART</button>
            <button class="share-btn" id="copy-btn">ğŸ“‹ COPY REPORT</button>
            <button class="share-btn" id="x-btn">ğ• X (Twitter)</button>
            <button class="share-btn" id="fb-btn">f Facebook</button>
        </div>

        <div class="ad-banner" style="margin-top:30px;">ADVERTISEMENT - FOOTER</div>

        <footer>
            <div class="privacy-links">
                <a href="#" id="t-p1">Privacy Policy</a>
                <a href="#" id="t-p2">Terms of Service</a>
            </div>
            <p id="t-disclaim">Destiny is constant, trading has its way. For reference only.</p>
            <p>Â© 2025 LuckyFortune Pro.</p>
        </footer>
    </div>

<script>
(function() {
    let curLang = 'zh';
    let kData = [];
    const TG = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
    const DZ = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
    
    const uiLang = {
        zh: { title: "å‘½é‹å¤©æ©Ÿäº¤æ˜“çµ‚ç«¯", y: "å‡ºç”Ÿå¹´", m: "æœˆ", d: "æ—¥", btn: "è§£ç¢¼å¤©å‘½æ•¸æ“šæµ", l1: "å¹´æŸ±/æ ¼å±€", l2: "ç´«å¾®ä¸»æ˜Ÿ", l3: "ç´éŸ³/å±¬æ€§", save: "ğŸ“¸ ä¿å­˜å¸¶æ°´å°æˆªåœ–", copy: "ğŸ“‹ è¤‡è£½å°ˆå®¶ç ”å ±", p1: "éš±ç§æ”¿ç­–", p2: "æœå‹™æ¢æ¬¾", disclaim: "å¤©å‘½æœ‰å¸¸ï¼Œäº¤æ˜“æœ‰é“ã€‚ç³»çµ±åƒ…ä¾›åƒè€ƒã€‚", water: "Life K-Line Pro | å¤©å‘½æœ‰å¸¸ äº¤æ˜“æœ‰é“" },
        en: { title: "DESTINY K-LINE TERMINAL", y: "YEAR", m: "MONTH", d: "DAY", btn: "DECODE DESTINY STREAM", l1: "PILLAR", l2: "MAIN STAR", l3: "ELEMENT", save: "ğŸ“¸ SAVE IMAGE", copy: "ğŸ“‹ COPY REPORT", p1: "Privacy", p2: "Terms", disclaim: "Destiny is constant, trading has its way. For reference only.", water: "Life K-Line Pro | Trading with Destiny" }
    };

    const matrix = {
        zh: {
            stars: ["ç´«å¾®", "å¤©æ©Ÿ", "å¤ªé™½", "æ­¦æ›²", "å¤©åŒ", "å»‰è²", "å¤©åºœ", "å¤ªé™°", "è²ªç‹¼", "å·¨é–€", "å¤©ç›¸", "å¤©æ¢", "ä¸ƒæ®º", "ç ´è»"],
            intro: ["æ ¼å±€ç‚ºã€Œ{star}ã€ç¨åï¼Œç´éŸ³{na}ï¼Œè³‡ç”¢æ¨¡å‹å‘ˆç¾å…¸å‹çš„ã€Œè„ˆè¡å¼æˆé•·ã€ã€‚", "æœ¬å‘½{gz}ï¼Œ{na}æ ¼å±€ã€‚å¤©ç›¤ç¾ã€Œé›™ç¥¿äº¤æµã€ä¹‹å…†ï¼Œç©¿é€é€±æœŸèƒ½åŠ›å¼·ã€‚", "èº«å…¥{star}ä¹‹å¢ƒï¼Œå¸¶æœ‰ã€Œæ®ºç ´ç‹¼ã€è®Šé©åŸºå› ï¼Œé©åˆåœ¨æ¥µç«¯æ³¢å‹•ä¸­æ•æ‰èºé·æ©Ÿæœƒã€‚"],
            peak: ["äººç”Ÿä¸»å‡æµªé–å®šåœ¨ <span class='highlight'>{year}å¹´</span>ï¼ŒåŒ–ç¥¿å…¥å‘½ï¼Œè³‡ç”¢æº¢åƒ¹æœ€é«˜çª—å£ã€‚", "æ•¸æ“šæµé¡¯ç¤º <span class='highlight'>{year}å¹´</span> é€¢å¤©é­åŠ æŒï¼Œç¤¾æœƒæ§“æ¡¿é”åˆ°æœ€å¤§åŒ–ã€‚", "è§€æ¸¬åˆ° <span class='highlight'>{year}å¹´</span> æœ‰å¼·çƒˆå¤šé ­ä¿¡è™Ÿï¼Œé©åˆé€²è¡Œè³‡ç”¢çµæ§‹å„ªåŒ–ã€‚"],
            risk: ["è­¦æƒ• <span class='highlight'>{year}å¹´</span> æ·±åº¦å›æ’¤ï¼Œåœ°æ”¯é€¢æ­²ç ´ï¼Œå»ºè­°æ¸…ç©ºé«˜æ§“æ¡¿éƒ¨ä½ã€‚", "åœ¨ <span class='highlight'>{year}å¹´</span> è§€æ¸¬åˆ°ç©ºäº¡è·¡è±¡ï¼Œæ­¤éšæ®µå®œæŒå¹£è§€æœ›ï¼Œé¿å…æŠ•æ©Ÿã€‚", "æ³¨æ„ <span class='highlight'>{year}å¹´</span> ç¯‰åº•éœ‡ç›ªï¼Œé€™æ˜¯å°å¿ƒç†ç´ è³ªçš„è€ƒé©—ï¼Œåˆ‡å‹¿é»æ˜å‰æ­¢æã€‚"],
            clash: ["æµå¹´æç¤ºï¼šæ¯é€¢ {clash} å¹´åœ°æ”¯å…­è¡ï¼Œæ³¢å‹•åŠ å€ã€‚æ³¢å‹•å³æ˜¯æ’¿æ‹¾å»‰åƒ¹ç±Œç¢¼çš„æ©Ÿæœƒã€‚", "èƒ½é‡å»ºè­°ï¼šåœ¨ {clash} å¹´æ°£å ´è¡çªåš´é‡ï¼Œå»ºè­°æ¡å–ç¾é‡‘ç‚ºç‹ç­–ç•¥æ‡‰å°ã€‚"],
            advice: ["ç­–ç•¥ï¼šçŸ¥å‘½è€Œä¸ä¿¡å‘½ï¼Œåˆ©ç”¨Kç·šè¦å¾‹é€²è¡Œéå°ç¨±åšå¼ˆï¼Œå¯¦ç¾éšç´šè·¨è¶Šã€‚", "å¿ƒæ³•ï¼šè²¡å¯Œæ˜¯èªçŸ¥çš„è®Šç¾ã€‚åœ¨ä½è°·æœŸä¿®ç…‰èªçŸ¥ï¼Œåœ¨é«˜æ½®æœŸäº«å—è¤‡åˆ©ã€‚"]
        },
        en: {
            stars: ["ZiWei", "TianJi", "Sun", "WuQu", "TianTong", "LianZhen", "TianFu", "Moon", "TanLang", "JuMen", "TianXiang", "TianLiang", "QiSha", "PoJun"],
            intro: ["Structure is {star}, {na} element. Typical 'Step-growth' asset model.", "Born in {gz}. Data shows 'Wealth-Carriage' signs with strong cycle resilience.", "Enter {star} state. Possesses 'Aggressive' genes, ideal for capturing volatility."],
            peak: ["Main surge locked in <span class='highlight'>{year}</span>. Prosperity stars align for maximum premium.", "Data indicates <span class='highlight'>{year}</span> has 'Noble' support. Social leverage peaks here.", "Strong bullish signals in <span class='highlight'>{year}</span>. Time for restructuring."],
            risk: ["Caution for drawdown in <span class='highlight'>{year}</span>. Defensive positions recommended.", "Signs of 'Void' in <span class='highlight'>{year}</span>. Stay liquid, avoid high leverage.", "Correction expected in <span class='highlight'>{year}</span>. A test of patience; don't exit before dawn."],
            clash: ["Tips: Every {clash} year brings clash. Volatility is your friend if prepared.", "Advice: High energy clash in {clash}. Cash-is-king strategy advised."],
            advice: ["Strategy: Use K-line laws for asymmetric bets to achieve class leap.", "Mindset: Wealth is converted knowledge. Build in troughs, harvest in peaks."]
        }
    };

    const canvas = document.getElementById('kCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('tooltip');

    function getGanZhi(year) { let offset = year - 4; return TG[offset % 10] + DZ[offset % 12]; }
    function getNaYin(gz) {
        const p = ["é‡‘å‘½/Gold", "æ°´å‘½/Water", "ç«å‘½/Fire", "åœŸå‘½/Earth", "æœ¨å‘½/Wood"];
        const i = (TG.indexOf(gz[0]) % 5 + Math.floor(DZ.indexOf(gz[1]) % 6 / 2)) % 5;
        return p[i].split('/')[curLang === 'zh' ? 0 : 1];
    }

    function draw() {
        const y = parseInt(document.getElementById('year').value);
        const m = parseInt(document.getElementById('month').value);
        const d = parseInt(document.getElementById('day').value);
        if (!y || !m || !d) return;

        const gz = getGanZhi(y);
        const star = matrix[curLang].stars[(y + m + d) % 14];
        const na = getNaYin(gz);
        document.getElementById('val-gz').innerText = gz;
        document.getElementById('val-star').innerText = star;
        document.getElementById('val-na').innerText = na;

        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const w = rect.width, h = rect.height;
        ctx.fillStyle = "#0b0e11"; ctx.fillRect(0,0,w,h);

        let curY = h * 0.6; kData = [];
        let maxP = {y:0, v:999}, minP = {y:0, v:-999};

        for (let i = 0; i < 50; i++) {
            const cy = y + i;
            const cgz = getGanZhi(cy);
            let vol = (Math.abs(DZ.indexOf(gz[1]) - DZ.indexOf(cgz[1])) === 6) ? 75 : 28;
            const r = (Math.abs(Math.sin(cy * 1.6 + m + d + i)) * 1000) % 1;
            const open = curY, close = curY - (r - 0.5) * vol;
            kData.push({ x: 40 + i * ((w-70)/50), open, close, year: cy, gz: cgz, change: ((open-close)/open*100).toFixed(2) });
            if (close < maxP.v) { maxP.v = close; maxP.y = cy; }
            if (close > minP.v) { minP.v = close; minP.y = cy; }
            ctx.strokeStyle = ctx.fillStyle = close < open ? "#0ecb81" : "#f6465d";
            ctx.beginPath(); ctx.moveTo(kData[i].x, open); ctx.lineTo(kData[i].x, close); ctx.lineWidth = 3; ctx.stroke();
            if (i % 10 === 0) { ctx.fillStyle = "#474d57"; ctx.font = "10px monospace"; ctx.fillText(cy, kData[i].x-12, h-12); }
            curY = close;
        }

        const seed = y + m + d;
        const M = matrix[curLang];
        const select = (arr, salt) => arr[(seed + salt) % arr.length];
        
        const report = `ğŸ“Š ${curLang === 'zh' ? 'ã€å¤©å‘½ç ”å ±ã€‘' : '[DESTINY REPORT]'}\n\n` +
            `âœ¨ ${curLang === 'zh' ? 'æ ¼å±€' : 'STATUS'}: <span class="highlight">${gz} / ${star}</span>\n\n` +
            `1ï¸âƒ£ ${select(M.intro, 1).replace("{star}", star).replace("{na}", na).replace("{gz}", gz)}\n\n` +
            `2ï¸âƒ£ ${select(M.peak, 2).replace("{year}", maxP.y)}\n\n` +
            `3ï¸âƒ£ ${select(M.risk, 3).replace("{year}", minP.y)}\n\n` +
            `4ï¸âƒ£ ${select(M.clash, 4).replace("{clash}", getGanZhi(y+12))}\n\n` +
            `5ï¸âƒ£ ${select(M.advice, 5)}`;

        document.getElementById('shareText').innerHTML = report;
        document.getElementById('shareArea').style.display = 'block';
        document.getElementById('action-grid').style.display = 'grid';
    }

    // é¼ æ¨™ç§»å‹•æç¤ºåŠŸèƒ½
    canvas.addEventListener('mousemove', (e) => {
        if (!kData.length) return;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const p = kData.reduce((prev, curr) => Math.abs(curr.x - mx) < Math.abs(prev.x - mx) ? curr : prev);
        
        if (Math.abs(p.x - mx) < 15) {
            tooltip.style.display = 'block';
            tooltip.style.left = (mx + 15) + 'px';
            tooltip.style.top = '20px';
            const color = p.close < p.open ? '#0ecb81' : '#f6465d';
            tooltip.innerHTML = `<b style="color:var(--gold)">${p.year} (${p.gz})</b><br><span style="color:${color}">${p.change > 0 ? 'â–²' : 'â–¼'} ${Math.abs(p.change)}%</span>`;
        } else { tooltip.style.display = 'none'; }
    });

    canvas.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });

    function switchLang() {
        curLang = curLang === 'zh' ? 'en' : 'zh';
        const L = uiLang[curLang];
        document.getElementById('t-title').innerText = L.title;
        document.getElementById('t-y').innerText = L.y;
        document.getElementById('t-m').innerText = L.m;
        document.getElementById('t-d').innerText = L.d;
        document.getElementById('main-btn').innerText = L.btn;
        document.getElementById('t-l1').innerText = L.l1;
        document.getElementById('t-l2').innerText = L.l2;
        document.getElementById('t-l3').innerText = L.l3;
        document.getElementById('save-btn').innerText = L.save;
        document.getElementById('copy-btn').innerText = L.copy;
        document.getElementById('t-disclaim').innerText = L.disclaim;
        if(kData.length > 0) draw();
    }

    document.getElementById('lang-btn').addEventListener('click', switchLang);
    document.getElementById('main-btn').addEventListener('click', draw);
    document.getElementById('save-btn').addEventListener('click', () => {
        const temp = document.createElement('canvas');
        const tCtx = temp.getContext('2d');
        temp.width = canvas.width; temp.height = canvas.height;
        tCtx.drawImage(canvas, 0, 0);
        tCtx.fillStyle = "rgba(240, 185, 11, 0.4)";
        tCtx.font = "bold 20px Arial"; tCtx.textAlign = "right";
        tCtx.fillText(uiLang[curLang].water, temp.width - 20, temp.height - 40);
        const a = document.createElement('a'); a.download = `Destiny_${Date.now()}.png`; a.href = temp.toDataURL(); a.click();
    });
    document.getElementById('copy-btn').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('shareArea').innerText).then(() => alert("Copied!"));
    });
})();
</script>
</body>
</html>