<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life K-Line Pro | å¤©å‘½äº¤æ˜“çµ‚ç«¯</title>
    <style>
        :root { 
            --gold: #f0b90b; --bg: #0b0e11; --card: #161a1e; --border: #2b2f36;
            --text-main: #eaecef; --text-dim: #848e9c; --green: #0ecb81; --red: #f6465d; 
        }
        body { 
            background: var(--bg); color: var(--text-main); 
            font-family: "PingFang SC", "Microsoft JhengHei", sans-serif; 
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; 
        }
        .container { width: 100%; max-width: 500px; box-sizing: border-box; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; width: 100%; }
        .header h2 { font-size: 14px; color: var(--gold); margin: 0; letter-spacing: 1px; }
        .lang-btn { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; }

        .ad-slot { width: 100%; margin: 10px 0; padding: 8px; background: #1c2127; border: 1px dashed var(--border); text-align: center; color: var(--text-dim); font-size: 10px; border-radius: 4px; }

        /* Dashboard */
        .destiny-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin: 10px 0; }
        .stat-box { background: var(--card); border: 1px solid var(--border); padding: 8px; border-radius: 4px; text-align: center; border-top: 2px solid var(--gold); }
        .stat-label { font-size: 9px; color: var(--text-dim); margin-bottom: 2px; }
        .stat-value { font-size: 12px; color: var(--gold); font-weight: bold; }

        /* Input */
        .input-grid { display: flex; gap: 6px; margin-bottom: 10px; }
        input { background: #1e2329; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 4px; font-size: 14px; flex: 1; outline: none; min-width: 0; }
        #main-btn { width: 100%; background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 4px; font-weight: bold; font-size: 14px; cursor: pointer; }

        /* Chart & Tooltip */
        #canvasWrap { width: 100%; height: 320px; background: #0b0e11; border: 1px solid var(--border); position: relative; border-radius: 4px; cursor: crosshair; }
        canvas { display: block; width: 100%; height: 100%; }
        #tooltip { 
            position: absolute; display: none; background: rgba(30, 35, 41, 0.95); 
            border: 1px solid var(--gold); padding: 8px; border-radius: 4px; 
            font-size: 11px; z-index: 100; pointer-events: none; min-width: 100px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        /* Report */
        #shareArea { display: none; margin-top: 15px; border: 1px solid var(--border); padding: 15px; border-radius: 4px; background: #161a1e; border-left: 4px solid var(--gold); }
        #shareText { font-size: 13px; line-height: 1.8; color: var(--text-main); white-space: pre-wrap; }
        .highlight { color: var(--gold); font-weight: bold; }

        /* Actions */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 15px; display: none; }
        .share-btn { background: #2b2f36; color: white; border: none; padding: 12px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .btn-gold { background: var(--gold); color: #000; font-weight: bold; }

        footer { margin-top: 30px; font-size: 11px; color: var(--text-dim); text-align: center; line-height: 1.6; padding-bottom: 20px; }
        .disclaimer { border-top: 1px solid var(--border); padding-top: 15px; margin-top: 15px; color: var(--text-dim); font-style: italic; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2 id="t-site-title">DESTINY K-LINE TERMINAL</h2>
            <button id="lang-btn" class="lang-btn">English / ä¸­æ–‡</button>
        </div>

        <div class="ad-slot">ADVERTISEMENT / è´ŠåŠ©å•†å»£å‘Š</div>

        <div class="destiny-dashboard">
            <div class="stat-box"><div class="stat-label" id="t-lab-gz">å¹´æŸ±</div><div class="stat-value" id="val-gz">--</div></div>
            <div class="stat-box"><div class="stat-label" id="t-lab-star">ä¸»æ˜Ÿ</div><div class="stat-value" id="val-star">--</div></div>
            <div class="stat-box"><div class="stat-label" id="t-lab-na">ç´éŸ³</div><div class="stat-value" id="val-na">--</div></div>
        </div>

        <div class="input-grid">
            <input type="number" id="year" placeholder="YYYY">
            <input type="number" id="month" placeholder="MM">
            <input type="number" id="day" placeholder="DD">
        </div>
        <button id="main-btn">ANALYZE DATA STREAM</button>
        
        <div id="canvasWrap">
            <div id="tooltip"></div>
            <canvas id="kCanvas"></canvas>
        </div>

        <div id="shareArea">
            <div id="shareText"></div>
            <div class="ad-slot" style="margin-top:15px">SPONSORED CONTENT</div>
        </div>

        <div class="action-grid" id="action-grid">
            <button class="share-btn btn-gold" id="save-btn">SAVE IMAGE</button>
            <button class="share-btn" id="copy-btn">COPY REPORT</button>
            <button class="share-btn" id="x-btn">X (Twitter)</button>
            <button class="share-btn" id="fb-btn">Facebook</button>
        </div>

        <footer>
            <p>Â© 2025 Life K-Line Pro. <a href="#" style="color:var(--gold);text-decoration:none;">Privacy Policy</a></p>
            <p class="disclaimer" id="t-disclaimer">å¤©å‘½æœ‰å¸¸ï¼Œäº¤æ˜“æœ‰é“ã€‚ç³»çµ±åƒ…ä¾›åƒè€ƒã€‚</p>
        </footer>
    </div>

<script>
(function() {
    let currentLang = 'en';
    let kData = [];
    const TG = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
    const DZ = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
    const ZW_STARS = {
        zh: ["ç´«å¾®", "å¤©æ©Ÿ", "å¤ªé™½", "æ­¦æ›²", "å¤©åŒ", "å»‰è²", "å¤©åºœ", "å¤ªé™°", "è²ªç‹¼", "å·¨é–€", "å¤©ç›¸", "å¤©æ¢", "ä¸ƒæ®º", "ç ´è»"],
        en: ["ZiWei", "TianJi", "Sun", "WuQu", "TianTong", "LianZhen", "TianFu", "Moon", "TanLang", "JuMen", "TianXiang", "TianLiang", "QiSha", "PoJun"]
    };

    const i18n = {
        en: {
            title: "DESTINY K-LINE TERMINAL", btn: "ANALYZE DATA STREAM",
            labGz: "Pillar", labStar: "Main Star", labNa: "Element",
            disclaimer: "Destiny is constant, trading has its way. For reference only.",
            reportTitle: "ğŸ“Š [DESTINY ANALYSIS REPORT]",
            labelStatus: "âœ¨ STATUS", labelAdv: "ğŸ’¡ EXPERT STRATEGY"
        },
        zh: {
            title: "å‘½é‹å¤©æ©Ÿäº¤æ˜“çµ‚ç«¯", btn: "åŒæ­¥å¤©å‘½æ•¸æ“šæµ",
            labGz: "å¹´æŸ±", labStar: "å‘½å®®ä¸»æ˜Ÿ", labNa: "ç´éŸ³äº”è¡Œ",
            disclaimer: "å¤©å‘½æœ‰å¸¸ï¼Œäº¤æ˜“æœ‰é“ã€‚ç³»çµ±åƒ…ä¾›åƒè€ƒã€‚",
            reportTitle: "ğŸ“Š ã€ç”Ÿå‘½è³‡ç”¢æ·±åº¦ç ”å ±ã€‘",
            labelStatus: "âœ¨ æ ¸å¿ƒæ ¼å±€", labelAdv: "ğŸ’¡ å°ˆå®¶ç´šç­–ç•¥è§£è®€"
        }
    };

    function getGanZhi(year) {
        let offset = year - 4;
        return TG[offset % 10] + DZ[offset % 12];
    }
    
    function getNaYin(gz, lang) {
        const naPool = lang === 'zh' ? ["é‡‘", "æ°´", "ç«", "åœŸ", "æœ¨"] : ["Gold", "Water", "Fire", "Earth", "Wood"];
        const gIdx = TG.indexOf(gz[0]) % 5;
        const zIdx = DZ.indexOf(gz[1]) % 6;
        return naPool[(gIdx + Math.floor(zIdx/2)) % 5] + (lang === 'zh' ? "å‘½" : "");
    }

    const canvas = document.getElementById('kCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('tooltip');

    function draw() {
        const y = parseInt(document.getElementById('year').value);
        const m = parseInt(document.getElementById('month').value);
        const d = parseInt(document.getElementById('day').value);
        if (!y || !m || !d) return;

        const gz = getGanZhi(y);
        const star = ZW_STARS[currentLang][(y + m + d) % 14];
        const nayin = getNaYin(gz, currentLang);
        document.getElementById('val-gz').innerText = gz;
        document.getElementById('val-star').innerText = star;
        document.getElementById('val-na').innerText = nayin;

        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const w = rect.width, h = rect.height;
        ctx.fillStyle = "#0b0e11"; ctx.fillRect(0,0,w,h);

        let curY = h * 0.6;
        kData = [];
        const birthZhiIdx = DZ.indexOf(gz[1]);

        for (let i = 0; i < 50; i++) {
            const currentYear = y + i;
            const currentGz = getGanZhi(currentYear);
            let vol = 30;
            if (Math.abs(birthZhiIdx - DZ.indexOf(currentGz[1])) === 6) vol = 75; // å…­è¡å¹´ä»½
            
            const r = (Math.abs(Math.sin(currentYear * 1.5 + m + d)) * 1000) % 1;
            const move = (r - 0.5) * vol;
            const open = curY, close = curY - move;
            const x = 30 + i * ((w-50)/50);

            kData.push({ x, open, close, year: currentYear, gz: currentGz, change: ((open-close)/open*100).toFixed(2) });

            ctx.strokeStyle = ctx.fillStyle = close < open ? "#0ecb81" : "#f6465d";
            ctx.beginPath(); ctx.moveTo(x, open); ctx.lineTo(x, close); ctx.lineWidth = 3; ctx.stroke();
            if (i % 10 === 0) {
                ctx.fillStyle = "#474d57"; ctx.font = "9px monospace";
                ctx.fillText(currentYear, x-10, h-10);
            }
            curY = close;
        }

        generateReport(gz, star, nayin, y);
    }

    function generateReport(gz, star, nayin, y) {
        const L = i18n[currentLang];
        const content = currentLang === 'zh' ? 
            `1ï¸âƒ£ ã€æ ¼å±€åˆ¤æ–·ã€‘ï¼šæœ¬å‘½<span class="highlight">${gz}</span>ï¼Œå±¬<span class="highlight">${nayin}</span>ã€‚${star}åŒ–æ¬Šå…¥å‘½ï¼Œå…·å‚™æ¥µå¼·çš„å¸‚å ´å—…è¦ºã€‚ä½ çš„è³‡ç”¢å¢é•·ä¾è³´ã€Œä¿¡æ¯å·®ã€èˆ‡ã€Œé‹å‹¢æ§“æ¡¿ã€ã€‚\n\n` +
            `2ï¸âƒ£ ã€æµå¹´é è­¦ã€‘ï¼šæ³¨æ„åœ°æ”¯é€¢ã€Œå…­è¡ã€å¹´ä»½ï¼ˆå¦‚${DZ[(DZ.indexOf(gz[1])+6)%12]}å¹´ï¼‰ã€‚æ³¢å‹•ç‡æœƒé™¡å¢ï¼Œå»ºè­°åœ¨æ­¤æœŸé–“æ¡å–é˜²å®ˆç­–ç•¥ï¼Œé¿å…é«˜æ§“æ¡¿æ“ä½œã€‚\n\n` +
            `3ï¸âƒ£ ã€è³‡ç”¢ä½ˆå±€ã€‘ï¼šè²¡å¸›å®®é¡¯ç¤ºï¼Œè¤‡åˆ©æ•ˆæ‡‰å°‡åœ¨35æ­²å¾Œé¡¯ç¾ã€‚${y+25}å¹´å‰å¾Œå°‡è¿ä¾†äººç”Ÿæœ€å¼·ã€Œå¤šé ­æ’åˆ—ã€ï¼Œé‚£æ˜¯è³‡ç”¢èºé·çš„é»ƒé‡‘çª—å£ã€‚\n\n` +
            `4ï¸âƒ£ ã€é¢¨æ§å»ºè­°ã€‘ï¼šå‘½ç†ç‚ºåŸºæœ¬é¢ï¼Œå¿ƒæ…‹ç‚ºäº¤æ˜“é¢ã€‚åœ¨Kç·šç¯‰åº•æœŸï¼Œå°ˆæ³¨ç©ç´¯å…§åœ¨åƒ¹å€¼ï¼Œæ–¹èƒ½åœ¨ä¸»å‡æµªä¾†è‡¨æ™‚å¯¦ç¾è¶…é¡å›å ±ã€‚` :
            `1. [Pillar]: Born in ${gz} year, ${nayin} element. ${star} star dominant. You have strong market intuition; wealth grows through "Information Asymmetry".\n\n` +
            `2. [Volatility]: Watch out for "Clash Years" (e.g., ${DZ[(DZ.indexOf(gz[1])+6)%12]} years). Volatility spikes here; stay defensive and avoid high leverage.\n\n` +
            `3. [Compounding]: Compounding effects strengthen after age 35. A major "Bull Run" is expected around ${y+25}, marking a golden window for asset growth.\n\n` +
            `4. [Strategy]: Destiny is the fundamental; mindset is the technical. Accumulate inner value during "Bottoming Phases" to capture excess returns in the next surge.`;

        document.getElementById('shareText').innerHTML = `${L.reportTitle}\n\n${L.labelStatus}: <span class="highlight">${gz} / ${star}</span>\n\n${L.labelAdv}:\n${content}`;
        document.getElementById('shareArea').style.display = 'block';
        document.getElementById('action-grid').style.display = 'grid';
    }

    // Tooltip Interaction
    canvas.addEventListener('mousemove', (e) => {
        if (!kData.length) return;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const point = kData.reduce((prev, curr) => Math.abs(curr.x - mx) < Math.abs(prev.x - mx) ? curr : prev);
        
        if (Math.abs(point.x - mx) < 10) {
            tooltip.style.display = 'block';
            tooltip.style.left = (mx + 15) + 'px';
            tooltip.style.top = '20px';
            const color = point.close < point.open ? "#0ecb81" : "#f6465d";
            tooltip.innerHTML = `<b style="color:var(--gold)">${point.year} (${point.gz})</b><br>` +
                                `<span style="color:${color}">${point.change > 0 ? 'â†‘' : 'â†“'} ${Math.abs(point.change)}%</span>`;
        } else { tooltip.style.display = 'none'; }
    });

    document.getElementById('lang-btn').addEventListener('click', () => {
        currentLang = currentLang === 'en' ? 'zh' : 'en';
        const L = i18n[currentLang];
        document.getElementById('t-site-title').innerText = L.title;
        document.getElementById('main-btn').innerText = L.btn;
        document.getElementById('t-lab-gz').innerText = L.labGz;
        document.getElementById('t-lab-star').innerText = L.labStar;
        document.getElementById('t-lab-na').innerText = L.labNa;
        document.getElementById('t-disclaimer').innerText = L.disclaimer;
        if(document.getElementById('year').value) draw();
    });

    document.getElementById('main-btn').addEventListener('click', draw);
    document.getElementById('copy-btn').addEventListener('click', () => {
        const text = document.getElementById('shareArea').innerText;
        navigator.clipboard.writeText(text); alert("Copied!");
    });
    document.getElementById('save-btn').addEventListener('click', () => {
        const link = document.createElement('a'); link.download = `Destiny_${Date.now()}.png`;
        link.href = canvas.toDataURL(); link.click();
    });
})();
</script>
</body>
</html>