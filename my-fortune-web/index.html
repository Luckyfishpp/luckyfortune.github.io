<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life K-Line Pro | å¤©å‘½é‡‘ç·šäº¤æ˜“çµ‚ç«¯</title>
    <meta name="description" content="å°ˆæ¥­ç´šäººç”Ÿ K ç·šåˆ†æçµ‚ç«¯ã€‚åˆ©ç”¨å¤§æ•¸æ“šè§£ç¢¼ä½ çš„è²¡å¯Œé€±æœŸèˆ‡äº¤æ˜“å¤©å‘½ã€‚">
    <meta name="keywords" content="Trading, Crypto, Bitcoin, Fortune, Destiny, K-Line, Financial Analytics">

    <style>
        :root { 
            --gold: #f0b90b; --bg: #0b0e11; --card: #161a1e; --border: #2b2f36;
            --text-main: #eaecef; --text-dim: #848e9c; --green: #0ecb81; --red: #f6465d; 
        }
        body { background: var(--bg); color: var(--text-main); font-family: "PingFang SC", "Microsoft JhengHei", sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; }
        .container { width: 100%; max-width: 500px; box-sizing: border-box; }
        
        /* A-Ads å»£å‘Šä½å„ªåŒ– */
        .ad-frame-wrapper { 
            width: 100%; margin: 15px auto; text-align: center; position: relative; z-index: 999; 
            background: #0d1117; border-radius: 4px; overflow: hidden; min-height: 60px;
        }
        .ad-frame-wrapper iframe { border: 0; padding: 0; width: 100%; height: 60px; display: block; margin: auto; }

        /* UI å…ƒä»¶ */
        .header { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .header h2 { font-size: 18px; color: var(--gold); margin: 0; letter-spacing: 1px; font-weight: 900; }
        .lang-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 12px; border-radius: 4px; font-size: 11px; cursor: pointer; }

        .destiny-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .stat-box { background: var(--card); border: 1px solid var(--border); padding: 12px 5px; border-radius: 4px; text-align: center; border-top: 2px solid var(--gold); }
        .stat-label { font-size: 10px; color: var(--text-dim); margin-bottom: 4px; }
        .stat-value { font-size: 14px; color: var(--gold); font-weight: bold; }

        .input-grid { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; }
        .input-group { flex: 1; display: flex; flex-direction: column; }
        input { background: #1e2329; border: 1px solid var(--border); color: white; padding: 12px; border-radius: 6px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; text-align: center; }
        input:focus { border-color: var(--gold); }

        #main-btn { width: 100%; background: var(--gold); color: #000; border: none; padding: 18px; border-radius: 6px; font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.2s; }
        #main-btn:active { transform: scale(0.98); }

        /* Kç·šåœ– - ä¿®æ­£æ”¾å¤§ Bug çš„æ ¸å¿ƒ CSS */
        #canvasWrap { width: 100%; height: 320px; background: #0b0e11; border: 1px solid var(--border); position: relative; border-radius: 6px; margin-top: 15px; overflow: hidden; }
        canvas { position: absolute; top: 0; left: 0; width: 100% !important; height: 100% !important; }
        #tooltip { position: absolute; display: none; background: rgba(30, 35, 41, 0.95); border: 1px solid var(--gold); padding: 8px; border-radius: 4px; font-size: 11px; z-index: 1001; pointer-events: none; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }

        /* è§£æå ±å‘Š */
        #shareArea { display: none; margin-top: 20px; border: 1px solid var(--border); padding: 25px; border-radius: 6px; background: #161a1e; border-left: 6px solid var(--gold); }
        #shareText { font-size: 14px; line-height: 1.9; color: var(--text-main); white-space: pre-wrap; }
        .highlight { color: var(--gold); font-weight: bold; }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; display: none; width: 100%; }
        .share-btn { background: #2b2f36; color: white; border: none; padding: 15px; font-size: 13px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-gold { background: var(--gold); color: #000; }

        footer { margin-top: 40px; font-size: 11px; color: var(--text-dim); text-align: center; border-top: 1px solid var(--border); padding: 25px 0; width: 100%; }
    </style>
</head>
<body>

    <div class="container">
        <div class="ad-frame-wrapper">
            <iframe data-aa='2422219' src='//acceptable.a-ads.com/2422219/?size=Adaptive'></iframe>
        </div>

        <div class="header">
            <h2 id="t-title">LIFE K-LINE PRO</h2>
            <button class="lang-btn" id="lang-btn">EN / ä¸­æ–‡</button>
        </div>

        <div class="destiny-dashboard">
            <div class="stat-box"><div class="stat-label">æ ¼å±€</div><div class="stat-value" id="val-gz">--</div></div>
            <div class="stat-box"><div class="stat-label">ä¸»æ˜Ÿ</div><div class="stat-value" id="val-star">--</div></div>
            <div class="stat-box"><div class="stat-label">ç´éŸ³</div><div class="stat-value" id="val-na">--</div></div>
        </div>

        <div class="input-grid">
            <div class="input-group"><input type="number" id="year" placeholder="YYYY"></div>
            <div class="input-group"><input type="number" id="month" placeholder="MM"></div>
            <div class="input-group"><input type="number" id="day" placeholder="DD"></div>
        </div>

        <button id="main-btn">è§£ç¢¼äº¤æ˜“å¤©å‘½</button>
        
        <div id="canvasWrap">
            <div id="tooltip"></div>
            <canvas id="kCanvas"></canvas>
        </div>

        <div class="ad-frame-wrapper">
            <iframe data-aa='2422219' src='//acceptable.a-ads.com/2422219/?size=Adaptive'></iframe>
        </div>

        <div id="shareArea">
            <div id="shareText"></div>
            <div style="margin-top:20px; padding-top:15px; border-top:1px dashed var(--border);">
                <iframe data-aa='2422219' src='//acceptable.a-ads.com/2422219/?size=Adaptive'></iframe>
            </div>
        </div>

        <div class="action-grid" id="action-grid">
            <button class="share-btn btn-gold" id="save-btn">ğŸ“¸ ä¿å­˜æˆªåœ–</button>
            <button class="share-btn" id="copy-btn">ğŸ“‹ è¤‡è£½ç ”å ±</button>
        </div>

        <footer>
            <p>æœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œäº¤æ˜“æœ‰é¢¨éšªï¼ŒæŠ•è³‡éœ€è¬¹æ…ã€‚</p>
            <p>Â© 2025 LuckyFortune Terminal | <span style="text-decoration:underline; cursor:pointer;">Privacy Policy</span></p>
        </footer>
    </div>

<script>
(function() {
    let curLang = 'zh';
    let kData = [];
    const TG = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
    const DZ = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
    
    const canvas = document.getElementById('kCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('tooltip');

    // æ ¸å¿ƒä¿®å¾©ï¼šåˆå§‹åŒ–ç•«å¸ƒå°ºå¯¸ï¼Œé¿å…é‡è¤‡è¨­ç½®å°è‡´æ”¾å¤§
    function initCanvas() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        // åªæœ‰ç•¶ç‰©ç†åƒç´ ä¸åŒ¹é…æ™‚æ‰èª¿æ•´ï¼Œé˜²æ­¢é»æ“Šæ™‚é‡ç½®å¯¬é«˜å°è‡´çš„æ”¾å¤§
        if (canvas.width !== Math.floor(rect.width * dpr)) {
            canvas.width = Math.floor(rect.width * dpr);
            canvas.height = Math.floor(rect.height * dpr);
            ctx.scale(dpr, dpr);
        }
    }

    window.addEventListener('resize', initCanvas);
    initCanvas();

    function getGanZhi(year) { let offset = year - 4; return TG[offset % 10] + DZ[offset % 12]; }
    function getNaYin(gz) {
        const p = ["é‡‘å‘½", "æ°´å‘½", "ç«å‘½", "åœŸå‘½", "æœ¨å‘½"];
        const i = (TG.indexOf(gz[0]) % 5 + Math.floor(DZ.indexOf(gz[1]) % 6 / 2)) % 5;
        return p[i];
    }

    function draw() {
        const y = parseInt(document.getElementById('year').value);
        const m = parseInt(document.getElementById('month').value);
        const d = parseInt(document.getElementById('day').value);
        if (!y || !m || !d) { alert("è«‹å®Œæ•´è¼¸å…¥å¹´æœˆæ—¥"); return; }

        initCanvas(); // ç¢ºä¿ç¹ªè£½å‰å°ºå¯¸æ­£ç¢º
        const rect = canvas.getBoundingClientRect();
        const w = rect.width;
        const h = rect.height;

        // ä½¿ç”¨ clearRect è€Œä¸æ˜¯é‡ç½®å¯¬é«˜ä¾†æ¸…ç©ºç•«å¸ƒï¼Œå¾¹åº•è§£æ±ºæ”¾å¤§ Bug
        ctx.clearRect(0, 0, w, h);
        ctx.fillStyle = "#0b0e11";
        ctx.fillRect(0, 0, w, h);

        const gz = getGanZhi(y);
        const stars = ["ç´«å¾®", "å¤©æ©Ÿ", "å¤ªé™½", "æ­¦æ›²", "å¤©åŒ", "å»‰è²", "å¤©åºœ", "å¤ªé™°", "è²ªç‹¼", "å·¨é–€", "å¤©ç›¸", "å¤©æ¢", "ä¸ƒæ®º", "ç ´è»"];
        const star = stars[(y + m + d) % 14];
        const na = getNaYin(gz);

        document.getElementById('val-gz').innerText = gz;
        document.getElementById('val-star').innerText = star;
        document.getElementById('val-na').innerText = na;

        let curY = h * 0.6;
        kData = [];
        let maxYear = y;

        for (let i = 0; i < 50; i++) {
            const cy = y + i;
            const cgz = getGanZhi(cy);
            let vol = (Math.abs(DZ.indexOf(gz[1]) - DZ.indexOf(cgz[1])) === 6) ? 70 : 25;
            const r = (Math.abs(Math.sin(cy * 1.6 + m + d + i)) * 1000) % 1;
            const open = curY, close = curY - (r - 0.5) * vol;
            
            const posX = 40 + i * ((w - 70) / 50);
            kData.push({ x: posX, open, close, year: cy, gz: cgz, change: ((open - close) / open * 100).toFixed(2) });

            ctx.strokeStyle = ctx.fillStyle = close < open ? "#0ecb81" : "#f6465d";
            ctx.beginPath();
            ctx.moveTo(posX, open);
            ctx.lineTo(posX, close);
            ctx.lineWidth = 2;
            ctx.stroke();

            if (i % 10 === 0) {
                ctx.fillStyle = "#474d57";
                ctx.font = "10px monospace";
                ctx.fillText(cy, posX - 12, h - 12);
            }
            curY = close;
        }

        // å ±å‘Šå…§å®¹
        const report = `ğŸ“Š ã€å¤©å‘½ç ”å ±ã€‘\n\nâœ¨ æ ¼å±€ï¼š${gz} / ${star} / ${na}\n\næ•¸æ“šæµé¡¯ç¤ºï¼Œæ‚¨çš„è³‡ç”¢æ¨¡å‹å‘ˆç¾ã€Œ${na}ã€ç‰¹æœ‰çš„ç©©å®šæ“´å¼µç‰¹å¾µã€‚${y+30}å¹´ å‰å¾Œå°‡è¿ä¾†é‡å¤§çš„å¤šé ­ä¿¡è™Ÿã€‚`;
        document.getElementById('shareText').innerText = report;
        document.getElementById('shareArea').style.display = 'block';
        document.getElementById('action-grid').style.display = 'grid';
    }

    canvas.addEventListener('mousemove', (e) => {
        if (!kData.length) return;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const p = kData.reduce((prev, curr) => Math.abs(curr.x - mx) < Math.abs(prev.x - mx) ? curr : prev);

        if (Math.abs(p.x - mx) < 10) {
            tooltip.style.display = 'block';
            tooltip.style.left = (mx + 15) + 'px';
            tooltip.style.top = '20px';
            tooltip.innerHTML = `<b>${p.year} (${p.gz})</b><br><span style="color:${p.close < p.open ? '#0ecb81' : '#f6465d'}">${p.change > 0 ? 'â–²' : 'â–¼'} ${Math.abs(p.change)}%</span>`;
        } else {
            tooltip.style.display = 'none';
        }
    });

    document.getElementById('main-btn').addEventListener('click', draw);
    document.getElementById('copy-btn').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('shareText').innerText).then(() => alert("ç ”å ±å·²è¤‡è£½ï¼"));
    });
})();
</script>
</body>
</html>
